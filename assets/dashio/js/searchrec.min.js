
var daterec, plant;
function qcsearchbnt()
{
    daterec = $('input[name="recdate"]').val();
    overall_list( daterec );
}


function overall_list( dat )
{
    $("div[name='acload']").show();
   var opt={
             url:'http://192.168.161.102/api_system/api_recsys/recsys_cntplanreceive/'
            ,mtyp : "post"
            ,dtyp : "json"
            ,parm : { d : dat }
           };
   const v = ajax_use(opt, function(e){
       console.log(e);
            $("#tabble-recoverall tr:nth-child(1)  th").eq(1).html(numberWithCommas(parseInt(e["51"]['AMPONT_PO']) + parseInt(e["52"]['AMPONT_PO'])));
            $("#tabble-recoverall tr:nth-child(3)  th").eq(1).html(numberWithCommas(parseInt(e["51"]['AMPONT_PO'])));
            $("#tabble-recoverall tr:nth-child(4)  th").eq(1).html(numberWithCommas(parseInt(e["51"]['AMPONT_VEND']))); 
            $("#tabble-recoverall tr:nth-child(7)  th").eq(1).html(numberWithCommas(parseInt(e["52"]['AMPONT_PO']  )));
            $("#tabble-recoverall tr:nth-child(8)  th").eq(1).html(numberWithCommas(parseInt(e["52"]['AMPONT_VEND']))); 

            $("div[name='acload']").hide();
   });
//    const udt = new Date( $(".inputdateselect").val() ).toString('yyyy-MM-dd');
//    location.replace( "http://192.168.161.102/report_access/Prod/prd/?d="+ udt );
}

function modalpnt(p, elm="")
{
    $("div[name='qcmodalload']").show();
    daterec = $('input[name="recdate"]').val();
    plant = p;
    $("#modalPrint").modal({
        show: false,
        backdrop: 'static'
    });    
    $("#modalPrint").modal("show");
    var opt={
        url:'http://192.168.161.102/api_system/api_recsys/recsys_planreceive/'
       ,mtyp : "post"
       ,dtyp : "json"
       ,parm : { d : daterec, plant:p }
      };
    const v = ajax_use(opt, function(e){
        console.log(e);   
        $('#DataPanel tbody').html('');

        for (const vu of e) {
            $('#DataPanel tbody').append(`<tr>
                                          <td>${vu["VEND_CD"]}</td>
                                          <td>${vu["VEND_ANAME"]}</td>
                                          <td>${vu["ITEM_CD"]}</td>
                                          <td>${vu["MODEL"]}</td>
                                          <td>${vu["QTY"]}</td>
                                          <td id="${vu["PONUMBER"]}"></td>
                                          </tr>
                                          `);  
            var qrcode = new QRCode(document.getElementById(vu["PONUMBER"]), {
                text: `GD${vu["PONUMBER"]}`,
                width: 80,
                height: 80,
                colorDark : "#000000",
                colorLight : "#ffffff",
                correctLevel : QRCode.CorrectLevel.H
            });
        }

    
        $("div[name='qcmodalload']").hide();
    }); 
}

function PrintPanel(tableId) {
    var divContents = document.getElementById(tableId).outerHTML;

    var printWindow = window.open('', '', 'height=600,width=1050,scrollbars=1');        
//สร้าง popup
    printWindow.document.write('<html><head>');

    printWindow.document.write('<link href="http://192.168.161.102/report_access/assets/dashio/css/style_print.css" rel="stylesheet">'); //css path  


    printWindow.document.write('</head><body onLoad="self.print();self.close();">'); 
// สั่ง Print เมื่อ reder เสร็จ
    printWindow.document.write(divContents);
    printWindow.document.write('</body></html>');
    printWindow.document.close();
//printWindow.print();   print แบบนี้มีปัญหา run ไม่ได้ทุก Browser
}

//เรียกใช้งาน
function JsPrint(tableId) { 
    var strWindowFeatures = "location=yes,height=570,width=520,scrollbars=yes,status=yes";
    window.open( `http://192.168.161.102/report_access/qc/printqc?d=${daterec}&t=${plant}`, "_blank", strWindowFeatures); 
    //printJS({ printable: tableId, type: 'html', documentTitle: ''   });//css:'http://192.168.161.102/report_access/assets/dashio/css/style_print.css'
}

function createPDF(form) {  
    getCanvas(form).then(function (canvas) {  
        var  
         img = canvas.toDataURL("image/png"),  
         doc = new jsPDF({  
             unit: 'px',  
             format: 'a4'  
         });  
        doc.addImage(img, 'JPEG', 20, 20);  
        doc.save('Bhavdip-html-to-pdf.pdf');  
        form.width(cache_width);  
    });  
}  

// create canvas object  
function getCanvas(form) {  
    var a4 = [595.28, 841.89]; // for a4 size paper width and height      
    form.width((a4[0] * 1.33333) - 80).css('max-width', 'none');  
    return html2canvas(form, {  
        imageTimeout: 2000,  
        removeContainer: true  
    });  
}


function searchData() {
    // Declare variables
    var input;
    input = document.getElementById("search-rec");
    filter = input.value.toLowerCase(); 
 
    $("#DataPanel tbody tr").filter(function() {
        $(this).toggle($(this).text().toLowerCase().indexOf(filter) > -1)
      });
  }



function ajax_use( opt, func )
{
    // console.log(opt);
    $.ajax({
        url     : opt.url,
        type    : opt.mtyp,
        dataType: opt.dtyp,
        data    : opt.parm,
        success : func,
        error : function(it)
            {
                console.log(it);   
            }
        });    
}
function numberWithCommas(x) {
    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}